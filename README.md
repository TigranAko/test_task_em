# test_task_em
–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ effective mobile. Backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äì —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
- [API Endpoints](#api-endpoints)
- [–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞](#—Å–∏—Å—Ç–µ–º–∞-–ø—Ä–∞–≤-–¥–æ—Å—Ç—É–ø–∞)
- [–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ](#—Ç–µ—Å—Ç–æ–≤—ã–µ-–¥–∞–Ω–Ω—ã–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ö–∞—Å—Ç–æ–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –Ω–∞ JWT —Ç–æ–∫–µ–Ω–∞—Ö —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ HTTP-only –∫—É–∫–∞—Ö
- **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —Å —Ä–æ–ª—è–º–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∏–∑–Ω–µ—Å-—ç–ª–µ–º–µ–Ω—Ç–æ–≤
- **–°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –º–æ–¥–µ–ª–µ–π, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞)
- **SQLAlchemy Core** –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ **SQLAlchemy ORM** –¥–ª—è –º–æ–¥–µ–ª–µ–π
- **–ì–æ—Ç–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python** 3.12.12
- **FastAPI** (–ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è)
- **SQLAlchemy** 2.0+
- **Pydantic** 2.0+
- **JWT** (PyJWT) –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- **bcrypt** –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- **SQLite** (–ª–µ–≥–∫–æ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ PostgreSQL)

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

### –°–ª–æ–∏:
1. **–ú–æ–¥–µ–ª–∏ (Models)** - SQLAlchemy mapped –∫–ª–∞—Å—Å—ã
2. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (Repositories)** - —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –Ω–∞ SQLAlchemy Core
3. **–°–µ—Ä–≤–∏—Å—ã (Services)** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. **API/–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã (Routers)** - HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã:
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** - –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- **–°–µ—Ä–≤–∏—Å** - –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- **Dependency Injection** - —á–µ—Ä–µ–∑ FastAPI Depends

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
git clone <repository-url>
cd <project-folder>
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install fastapi uvicorn sqlalchemy bcrypt pyjwt
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
python app/main.py
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

¬∑ Swagger UI: http://localhost:8000/docs
¬∑ ReDoc: http://localhost:8000/redoc

## üîå API Endpoints

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–ú–µ—Ç–æ–¥ Endpoint –û–ø–∏—Å–∞–Ω–∏–µ –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
POST /user/register –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ù–µ—Ç
POST /user/login –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É –ù–µ—Ç
POST /user/logout –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –î–∞
PUT /user/profile –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –î–∞
DELETE /user/profile –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (–º—è–≥–∫–æ–µ) –î–∞
GET /user/all –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –î–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)

## üîê –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã:

1. users - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
   ¬∑ id, firstname, email, password_hash, role_id, is_active
2. roles - —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   ¬∑ id, name (admin, user, guest, manager)
3. business_elements - –±–∏–∑–Ω–µ—Å-—ç–ª–µ–º–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
   ¬∑ id, name (users, products, permissions)
4. access_roles_rules - –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ —Ä–æ–ª–µ–π –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º
   ¬∑ role_id, element_id
   ¬∑ read_permission - —á—Ç–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   ¬∑ read_all_permission - —á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   ¬∑ create_permission - —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
   ¬∑ update_permission - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   ¬∑ update_all_permission - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   ¬∑ delete_permission - —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   ¬∑ delete_all_permission - —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤

### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤

1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∫—É–∫–∏ access_token
2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ PermissionService
3. –û—à–∏–±–∫–∏:
   ¬∑ 401 Unauthorized - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
   ¬∑ 403 Forbidden - –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è:

–†–æ–ª–∏ (4):

¬∑ admin - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
¬∑ manager - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é
¬∑ user - –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
¬∑ guest - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä

–ë–∏–∑–Ω–µ—Å-—ç–ª–µ–º–µ–Ω—Ç—ã (3):

¬∑ users - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
¬∑ products - —Ä–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ (mock)
¬∑ permissions - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

¬∑ Email: admin@example.com
¬∑ –ü–∞—Ä–æ–ª—å: admin
¬∑ –†–æ–ª—å: admin

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª –¥–æ—Å—Ç—É–ø–∞:

–ê–¥–º–∏–Ω (admin):

¬∑ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å–æ –≤—Å–µ–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏

–ú–µ–Ω–µ–¥–∂–µ—Ä (manager):

¬∑ users: —á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö (–±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è)
¬∑ products: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø (–∫—Ä–æ–º–µ —É–¥–∞–ª–µ–Ω–∏—è)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (user):

¬∑ users: —á—Ç–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö
¬∑ products: —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ

–ì–æ—Å—Ç—å (guest):

¬∑ products: —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ users.py            # –ú–∞—Ä—à—Ä—É—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ db.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
‚îú‚îÄ‚îÄ models/                # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îú‚îÄ‚îÄ roles.py
‚îÇ   ‚îú‚îÄ‚îÄ business_elements.py
‚îÇ   ‚îú‚îÄ‚îÄ access_roles_rules.py
‚îÇ   ‚îî‚îÄ‚îÄ sessions.py
‚îú‚îÄ‚îÄ repositories/         # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (SQLAlchemy Core)
‚îÇ   ‚îú‚îÄ‚îÄ base.py          # –ë–∞–∑–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îú‚îÄ‚îÄ roles.py
‚îÇ   ‚îú‚îÄ‚îÄ business_elements.py
‚îÇ   ‚îî‚îÄ‚îÄ access_roles_rules.py
‚îú‚îÄ‚îÄ schemas/             # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ users.py
‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ users.py         # UserService
‚îÇ   ‚îî‚îÄ‚îÄ permission_service.py  # PermissionService
‚îú‚îÄ‚îÄ main.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ database.db         # –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PostgreSQL

–í —Ñ–∞–π–ª–µ db/db.py –∑–∞–º–µ–Ω–∏—Ç–µ:

```python
url_db = "sqlite:///database.db"
```

–Ω–∞:

```python
url_db = "postgresql://user:password@localhost/dbname"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ JWT

–í services/users.py –∏–∑–º–µ–Ω–∏—Ç–µ:

```python
self.secret_key = "your-secret-key"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–ª–æ–∂–Ω—ã–π –∫–ª—é—á
self.token_expire_hours = 24         # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST "http://localhost:8000/user/register" \
  -H "Content-Type: application/json" \
  -d '{
    "firstname": "–ò–≤–∞–Ω",
    "email": "ivan@example.com",
    "password": "securepassword",
    "password_replay": "securepassword"
  }'
```

### –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

```bash
curl -X POST "http://localhost:8000/user/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "ivan@example.com",
    "password": "securepassword"
  }' \
  -c cookies.txt
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞)

```bash
curl -X GET "http://localhost:8000/user/all" \
  -b cookies.txt
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT